{
  "id": "sleep-cycle",
  "name": "Cognitive Sleep Cycle",
  "emoji": "üåô",
  "description": "Memory consolidation, decay processing, and graph maintenance during agent sleep. Mirrors biological sleep phases: hippocampal replay, slow-wave consolidation, synaptic pruning, and REM dream synthesis.",
  "triggers": [
    "sleep cycle",
    "memory consolidation",
    "cognitive maintenance",
    "graph maintenance",
    "custodian",
    "sleep"
  ],
  "enhancedThinkingEnabled": true,
  "steps": [
    {
      "id": "memory-replay",
      "name": "üîÑ Memory Replay (Hippocampal Phase)",
      "description": "Replay recent activity and identify significant events for consolidation.\n\n1. Run recent_activity to retrieve events since last sleep cycle\n2. Identify high-significance events: decisions made, lessons learned, bugs fixed, insights gained\n3. Extract recurring [[concepts]] and patterns across recent activity\n4. Flag items requiring consolidation vs. items safe to let decay\n5. Create replay summary with significance scores\n\nOutput: memory://custodian/replay-{timestamp}.md\nInclude: Significant events, recurring concepts, consolidation candidates",
      "requiresEnhancedThinking": true,
      "metadata": {
        "toolHints": {
          "RecentActivity": {
            "reason": "Retrieve events since last sleep cycle",
            "priority": "mandatory",
            "timespan": "1.00:00:00",
            "includeContent": true
          },
          "SequentialThinking": {
            "reason": "Pattern recognition across recent activity",
            "priority": "mandatory",
            "estimated_thoughts": 3,
            "focus_areas": ["Significance scoring", "Pattern identification", "Consolidation triage"]
          }
        },
        "reasoning_effort": "medium",
        "stop_conditions": ["Replay complete", "Significance scores assigned", "Consolidation candidates identified"],
        "next_actions": ["Memory consolidation"],
        "guardrails": {
          "recency_window": "Process last 24-48 hours of activity",
          "significance_threshold": "Flag items with 3+ concept connections"
        }
      }
    },
    {
      "id": "consolidation",
      "name": "üß† Memory Consolidation (Slow-Wave Phase)",
      "description": "üß† ENHANCED THINKING REQUIRED\n\nTransfer high-value episodic memory to semantic storage.\n\n1. For each consolidation candidate, distill key insights into wiki-style knowledge\n2. Search existing memory:// for related notes to update rather than duplicate\n3. Strengthen important concepts by creating/updating memory:// notes with rich [[WikiLinks]]\n4. Cross-link new knowledge to existing graph structure\n5. Update daily log with consolidation summary\n\nOutput: Updated memory:// notes, memory://logs/{date}.md\nInclude: Distilled insights, cross-links, consolidation decisions",
      "requiresEnhancedThinking": true,
      "metadata": {
        "toolHints": {
          "SearchMemories": {
            "reason": "Find existing notes to update",
            "priority": "mandatory",
            "mode": "Hybrid"
          },
          "WriteMemory": {
            "reason": "Persist consolidated knowledge",
            "priority": "mandatory"
          },
          "EditMemory": {
            "reason": "Update existing notes rather than duplicate",
            "priority": "recommended"
          },
          "SequentialThinking": {
            "reason": "Distillation requires synthesis",
            "priority": "mandatory",
            "estimated_thoughts": 4,
            "focus_areas": ["Insight extraction", "Deduplication", "Cross-linking"]
          }
        },
        "reasoning_effort": "high",
        "stop_conditions": ["Candidates consolidated", "No duplicates created", "Cross-links established"],
        "next_actions": ["Decay processing"],
        "guardrails": {
          "no_duplicates": "Always search before creating new notes",
          "wikilink_density": "Minimum 5 [[concepts]] per consolidated note",
          "update_preference": "Prefer editing existing notes over creating new ones"
        }
      }
    },
    {
      "id": "decay-processing",
      "name": "üçÇ Decay Processing (Synaptic Pruning)",
      "description": "Apply tiered decay to let irrelevant memories fade.\n\n1. Identify memories past their grace period by tier:\n   - thinking/sequential/: 7-day grace (MAENIFOLD_DECAY_GRACE_DAYS_SEQUENTIAL)\n   - thinking/workflows/: 14-day grace (MAENIFOLD_DECAY_GRACE_DAYS_WORKFLOWS)\n   - other memory://: 14-day grace (MAENIFOLD_DECAY_GRACE_DAYS_DEFAULT)\n2. Calculate decay weights based on last_accessed timestamps (30-day half-life default)\n3. Flag severely decayed content (weight < 0.25) for review (not deletion)\n4. Document decay state for monitoring\n5. Note: Decay affects search ranking only; content remains fully retrievable via direct query\n\nOutput: memory://custodian/decay-report-{timestamp}.md\nInclude: Decay statistics, flagged items, tier breakdown",
      "requiresEnhancedThinking": false,
      "metadata": {
        "toolHints": {
          "ListMemories": {
            "reason": "Enumerate memories with decay metadata (created, last_accessed, decay_weight)",
            "priority": "mandatory"
          },
          "WriteMemory": {
            "reason": "Document decay report",
            "priority": "mandatory"
          }
        },
        "reasoning_effort": "low",
        "stop_conditions": ["Decay calculated", "Report generated"],
        "next_actions": ["Concept repair"],
        "guardrails": {
          "no_deletion": "Decay affects ranking only, never delete content",
          "validated_exempt": "Validated assumptions never decay (NFR-7.8.1)",
          "access_boosting": "ReadMemory resets decay clock; frequently-accessed content stays fresh"
        }
      }
    },
    {
      "id": "concept-repair",
      "name": "üîß Concept Repair (Graph Maintenance)",
      "description": "Fix fragmented concepts and normalize WikiLinks.\n\n1. Run analyzeconceptcorruption on high-frequency concept families\n2. Identify variant forms, typos, and fragmentation (e.g., [[auth]] vs [[authentication]])\n3. Use repairconcepts with dryRun=true first to preview changes\n4. Apply repairs for clear cases; flag ambiguous cases for human review\n5. Sync graph to ensure consistency\n\nOutput: memory://custodian/repair-report-{timestamp}.md\nInclude: Repairs made, items flagged for review, graph health metrics",
      "requiresEnhancedThinking": true,
      "metadata": {
        "toolHints": {
          "AnalyzeConceptCorruption": {
            "reason": "Diagnose concept fragmentation",
            "priority": "mandatory"
          },
          "RepairConcepts": {
            "reason": "Normalize variant forms",
            "priority": "recommended",
            "dryRun": true
          },
          "Sync": {
            "reason": "Rebuild graph after repairs",
            "priority": "mandatory"
          }
        },
        "reasoning_effort": "medium",
        "stop_conditions": ["Analysis complete", "Clear cases repaired", "Ambiguous cases flagged"],
        "next_actions": ["Assumption review"],
        "guardrails": {
          "dry_run_first": "Always preview repairs before applying",
          "human_review": "Flag ambiguous merges for human decision",
          "high_frequency_focus": "Prioritize concepts with 10+ references"
        }
      }
    },
    {
      "id": "assumption-review",
      "name": "‚öñÔ∏è Assumption Review (Epistemic Hygiene)",
      "description": "üß† ENHANCED THINKING REQUIRED\n\nReview active assumptions and apply validation pressure.\n\n1. Query assumption_ledger for active and refined assumptions\n2. Check if recent activity provides evidence to validate or invalidate assumptions\n3. Update assumption status based on evidence found\n4. Apply decay pressure: assumptions lingering without validation lose priority\n   - validated: exempt from decay (immortal)\n   - active/refined: 14-day grace, 30-day half-life\n   - invalidated: 7-day grace, 14-day half-life (aggressive decay)\n5. Document assumption state changes\n\nOutput: memory://custodian/assumption-review-{timestamp}.md\nInclude: Assumptions reviewed, status changes, evidence cited",
      "requiresEnhancedThinking": true,
      "metadata": {
        "toolHints": {
          "AssumptionLedger": {
            "reason": "Query and update assumption status",
            "priority": "mandatory"
          },
          "SearchMemories": {
            "reason": "Find evidence for/against assumptions",
            "priority": "recommended"
          },
          "SequentialThinking": {
            "reason": "Evaluate evidence quality",
            "priority": "mandatory",
            "estimated_thoughts": 3,
            "focus_areas": ["Evidence evaluation", "Validation logic", "Status decisions"]
          }
        },
        "reasoning_effort": "medium",
        "stop_conditions": ["All active assumptions reviewed", "Status changes documented"],
        "next_actions": ["Dream synthesis"],
        "guardrails": {
          "evidence_required": "Status changes require cited evidence",
          "validation_immortality": "Validated assumptions become permanent (NFR-7.8.1)",
          "invalidation_decay": "Invalidated assumptions decay aggressively (NFR-7.8.3)"
        }
      }
    },
    {
      "id": "dream-synthesis",
      "name": "üí≠ Dream Synthesis (REM Phase)",
      "description": "üß† ENHANCED THINKING REQUIRED\n\nFind novel connections and surface unexpected insights.\n\n1. Select 3-5 high-value concepts from recent consolidation\n2. Run findsimilarconcepts to discover unexpected semantic neighbors\n3. Explore surprising connections that weren't explicitly linked\n4. Generate hypotheses about potential relationships worth investigating\n5. Document dream insights for future exploration\n\nOutput: memory://custodian/dream-synthesis-{timestamp}.md\nInclude: Novel connections discovered, hypotheses generated, exploration candidates",
      "requiresEnhancedThinking": true,
      "metadata": {
        "toolHints": {
          "FindSimilarConcepts": {
            "reason": "Discover unexpected semantic neighbors",
            "priority": "mandatory",
            "maxResults": 10
          },
          "BuildContext": {
            "reason": "Explore relationship neighborhoods",
            "priority": "recommended",
            "depth": 2
          },
          "SequentialThinking": {
            "reason": "Creative connection synthesis",
            "priority": "mandatory",
            "estimated_thoughts": 4,
            "focus_areas": ["Unexpected connections", "Hypothesis generation", "Creative leaps"]
          }
        },
        "reasoning_effort": "high",
        "stop_conditions": ["Novel connections identified", "Hypotheses documented"],
        "next_actions": ["Wake preparation"],
        "guardrails": {
          "novelty_focus": "Prioritize connections not already explicit in graph",
          "hypothesis_quality": "Hypotheses must be testable/actionable",
          "limit_scope": "Maximum 5 concepts explored per cycle"
        }
      }
    },
    {
      "id": "wake-preparation",
      "name": "üåÖ Wake Preparation",
      "description": "Prepare enriched context for next session.\n\n1. Summarize sleep cycle outcomes: consolidations, repairs, insights\n2. Identify priority items for next waking session\n3. Update heartbeat state with cycle completion timestamp\n4. Prepare context injection summary for session_start hook\n5. Log cycle metrics for longitudinal tracking\n\nOutput: memory://custodian/wake-context-{timestamp}.md, updated heartbeat-state.json\nInclude: Cycle summary, priority items, context injection payload",
      "requiresEnhancedThinking": false,
      "metadata": {
        "toolHints": {
          "WriteMemory": {
            "reason": "Document wake context",
            "priority": "mandatory"
          }
        },
        "reasoning_effort": "low",
        "stop_conditions": ["Summary complete", "State updated", "Context prepared"],
        "next_actions": ["Sleep cycle complete"],
        "guardrails": {
          "state_persistence": "Always update heartbeat-state.json",
          "context_size": "Wake context should be concise (<2000 tokens)"
        }
      }
    }
  ]
}
